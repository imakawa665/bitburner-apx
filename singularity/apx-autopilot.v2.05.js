/** apx-autopilot.v2.05.js (compact) */
import {Sing} from "apx-sing-actions.js";export async function main(ns){ns.disableLog("sleep");ns.clearPort(20);ns.clearPort(21);const F=ns.flags([["auto",true],["focus",false],["cmdPort",20],["statPort",21]]);const C={city:"Sector-12",gymLocation:"Powerhouse Gym",university:"Rothman University",budget:{reserve:500000},targets:{gym:{strength:100,defense:100,dexterity:100,agility:100},uni:{hacking:50,charisma:110}},crime:{prefer:"Mug",minChance:0.75,untilMoney:3e6}};const sing=new Sing(ns,{focus:F.focus,defaultCity:C.city,defaultGym:C.gymLocation,defaultUni:C.university,reserve:C.budget.reserve});const state={lock:false,mode:F.auto?'auto':'idle',stop:false};const withLock=async(fn)=>{if(state.lock)return false;state.lock=true;try{await fn()}finally{state.lock=false}return true};while(true){for(let i=0;i<10;i++){let m=ns.readPort(F.cmdPort);if(m==="NULL PORT DATA")break;try{const c=JSON.parse(m);if(c.cmd==="crime"&&sing.hasSF4)await withLock(async()=>await sing.runCrimeLoop({prefer:c.prefer??C.crime.prefer,minChance:c.minChance??C.crime.minChance,untilMoney:c.untilMoney??0}));}catch{}}await ns.sleep(1000)}}
